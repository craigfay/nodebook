<head>
  <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Mono&display=swap" rel="stylesheet">
  <style>
    html {
      font-family: 'Roboto Mono', sans-serif;
      font-size: 16px;
    }
    div.notebook {
      margin: 0 auto;
      display:flex;
      flex-direction: column;
      align-content: center;
      width: 600px;
    }
    .cell {
      margin-bottom: 20px;
      border-radius: 5px;
      border: 1px solid gainsboro;
      padding: 20px;
    }
    .cell .title {
      margin-bottom: 10px;
      color: darkslategray;
    }
    .cell .input {
      padding: .6rem;
      font-family: 'Roboto Mono', monospace;
      background-color: whitesmoke;
      border-radius: 5px;
    }
    .cell .input:focus {
      outline: none;
    }
    .cell .output {
      padding: .6rem;
      font-family: 'Roboto Mono', monospace;
      color: darkgreen;
    }
    .output:empty {
      display: none;
    }
    button.run {
      padding: 10px 20px; 
      width: 200px;
      background: purple;
      color: white;
      text-transform: uppercase;
      margin-bottom: 20px;
      font-size: 16px;
      border-radius: 5px;
    }
  </style>
</head>

<div class="notebook">
  <div class="cell">
    <div class="title">package.json</div>
    <div class="input dependencies" contenteditable></div>
    <div class="output dependencies"></div>
  </div>

  <div class="cell">
    <div class="title">index.js</div>
    <div class="input code" contenteditable></div>
    <div class="output code"></div>
  </div>

  <button class="run">Run</button>
</div>

<script>
  const endpoint = '/api/run'
  const replaceNonBreakingSpaces = str => str.replace(/\u00a0/g, " ")

  const dependencies = document.querySelector('.cell .input.dependencies')
  const input = document.querySelector('.cell .input.code')
  const run = document.querySelector('.run')
  const dependenciesOutput = document.querySelector('.output.dependencies');
  const codeOutput = document.querySelector('.output.code')
  run.addEventListener('click', async function() {
    // Show "loading" message
    dependenciesOutput.innerText = 'loading...'
    codeOutput.innerText = 'loading...'

    // Send Request
    const response = await fetch(endpoint, {
      method: 'POST',
      headers: { 'content-type': 'application/json' },
      body: JSON.stringify({
        dependencies: replaceNonBreakingSpaces(dependencies.innerText),
        javascript: replaceNonBreakingSpaces(input.innerText),
      })
    })

    // Handle Response
    if (!response.ok) return
    const { installation, execution } = await response.json()
    dependenciesOutput.innerText = installation
    codeOutput.innerText = execution 
  })
</script>